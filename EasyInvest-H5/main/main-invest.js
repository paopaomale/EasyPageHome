define(["butterfly/view","butterfly","shared/js/datasource","listview/ListView","swipe","iscroll","main/main-client","dialog","shared/js/mobiscroll/mobiscroll-concat"],function(a,b,c,d,e,f,g,h){return a.extend({events:{"click .contentWarp":"selectInvestItem"},render:function(){this.getMessage()},onShow:function(){this.initAdSwipe(),this.initListview()},getMessage:function(){var a=this;if(g.haveToken()){var b={pageSize:1,pageIndex:0};g.ajax({url:g.MESSAGE_GET_URL,data:b,beforeSend:function(){},success:function(b){b&&0===b.result&&b.data&&b.data[0]&&(a.$(".messageWarpText").html(b.data[0].content),a.UIShowMessage())},error:function(a){},complete:function(){}})}},UIShowMessage:function(){var a=this;a.$(".messageWarp").show(),a.$(".contentBody").addClass("hasMessage"),a.listview&&a.listview.IScroll&&a.listview.IScroll.refresh()},initListview:function(){var a=this;if(this.listview)this.listview.IScroll&&this.listview.IScroll.refresh();else{var b=new c({storage:"none",identifier:"investDatasource",url:g.PRODUCT_GET_URL,requestParams:{}}),e=this.$("#CBListview"),f=_.template(a.$("#listview-template").html());this.listview=new d({id:"investListview",el:e,autoLoad:!0,itemTemplate:f,dataSource:b})}},geneAdSwipeImg:function(a){for(var b='<%var img%><div class="adContent"><img width="100%" src="<%=window._serverBasePath + img%>"/></div>',c="",d=a.length,e=0;d>e;e++)c+=_.template(b,a[e]);return c},initAdSwipe:function(){var a=this;if(a.adSwipe)a.adSwipe.setup();else{var b={channelId:"2"};g.ajax({url:g.BANNER_TOP3_URL,data:b,method:"GET",beforeSend:function(){},success:function(b){if(b&&0===b.result&&b.data&&b.data.length){var c=a.geneAdSwipeImg(b.data);a.$(".adSwipe .swipe-wrap").html(c)}else a.$(".adSwipe .swipe-wrap").html('<div class="adContent"><img width="100%" src="../campaign/img/share.png"/></div>')},error:function(){a.$(".adSwipe .swipe-wrap").html('<div class="adContent"><img width="100%" src="../campaign/img/share.png"/></div>')},complete:function(){setTimeout(function(){a.adSwipe=new Swipe(a.$(".adSwipe")[0],{startSlide:0,speed:3e3,auto:1e3,continuous:!0,disableScroll:!1,stopPropagation:!1,closeEndMotion:!0})},0)}})}},selectInvestItem:function(a){if(g.haveToken()){var b=$(a.currentTarget).attr("id");butterfly.navigate("main/main-invest-detail.html",{id:b})}else h.showToast("登录后才能查看产品详情"),butterfly.navigate("account/login.html")}})});