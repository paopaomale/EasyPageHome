define(["underscore"],function(a){var b=function(){this.queue=[],this.onSuccess=function(){},this.onFail=function(){}};return a.extend(b.prototype,{add:function(a){return a.index=this.queue.length,this.queue.push(a),this},success:function(a){return this.onSuccess=a,this},fail:function(a){return this.onFail=a,this},execute:function(){var a=this.queue.length,b=[],c=this;this.queue.forEach(function(d,e){d.execute(function(d){b[e]=d,0==--a&&c.onSuccess(b)},function(a){c.abort(),c.onFail(a)})})},abort:function(){this.queue.forEach(function(a){a.abort&&a.abort()})}}),b});