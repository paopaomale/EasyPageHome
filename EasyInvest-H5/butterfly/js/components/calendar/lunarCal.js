define(["underscore","zepto"],function(a,b){var c=function(){this.lunarInfo=new Array(19416,19168,42352,21717,53856,55632,21844,22191,39632,21970,19168,42422,42192,53840,53909,46415,54944,44450,38320,18807,18815,42160,46261,27216,27968,43860,11119,38256,21234,18800,25958,54432,59984,27285,23263,11104,34531,37615,51415,51551,54432,55462,46431,22176,42420,9695,37584,53938,43344,46423,27808,46416,21333,19887,42416,17779,21183,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,38310,38335,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,23232,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,20854,21183,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19195,19152,42192,53430,53855,54560,56645,46496,22224,21938,18864,42359,42160,43600,45653,27951,44448,19299,37759,18936,18800,25776,26790,59999,27424,42692,43759,37600,53987,51552,54615,54432,55888,23893,22176,42704,21972,21200,43448,43344,46240,46758,44368,21920,43940,42416,21168,45683,26928,29495,27296,44368,19285,19311,42352,21732,53856,59752,54560,55968,27302,22239,19168,43476,42192,53584,62034,54560),this.solarMonth=new Array(31,28,31,30,31,30,31,31,30,31,30,31),this.Gan=new Array("甲","乙","丙","丁","戊","己","庚","辛","壬","癸"),this.Zhi=new Array("子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"),this.Animals=new Array("鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪"),this.solarTerm=new Array("小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"),this.sTermInfo=new Array(0,21208,42467,63836,85337,107014,128867,150921,173149,195551,218072,240693,263343,285989,308563,331033,353350,375494,397447,419210,440795,462224,483532,504758),this.nStr1=new Array("日","一","二","三","四","五","六","七","八","九","十"),this.nStr2=new Array("初","十","廿","卅","□"),this.monthName=new Array("JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"),this.cmonthName=new Array("正","二","三","四","五","六","七","八","九","十","十一","腊"),this.sFtv=new Array("0101*元旦","0214 情人节","0308 妇女节","0312 植树节","0401 愚人节","0501 劳动节","0504 青年节","0701 建党节","0801 建军节","0910 教师节","1001*国庆节","1224 平安夜","1225 圣诞节"),this.wFtv=new Array("0520 母亲节","0630 父亲节","1144 感恩节"),this.lFtv=new Array("0101*春节","0115 元宵节","0505 端午节","0707 七夕节","0815 中秋节","0909 重阳节","1208 腊八","1223 小年","0100*除夕")};a.extend(c.prototype,{lYearDays:function(a){var b,c=348;for(b=32768;b>8;b>>=1)c+=this.lunarInfo[a-1900]&b?1:0;return c+this.leapDays(a)},leapDays:function(a){return this.leapMonth(a)?15==(15&this.lunarInfo[a-1899])?30:29:0},leapMonth:function(a){var b=15&this.lunarInfo[a-1900];return 15==b?0:b},monthDays:function(a,b){return this.lunarInfo[a-1900]&65536>>b?30:29},getSolarDate:function(a,b,c,d){for(var e=0,f=1900;a>f;f++)e+=this.lYearDays(f);for(var f=1;b>f;f++)f==this.leapMonth(a)&&(e+=this.leapDays(a)),e+=this.monthDays(a,f);d&&(e+=this.monthDays(a,f)),e+=parseInt(c)-1;var g=new Date(1900,0,31),h=new Date(g.valueOf()+864e5*e);return h},solarDays:function(a,b){return 1==b?a%4==0&&a%100!=0||a%400==0?29:28:this.solarMonth[b]},cyclical:function(a){return this.Gan[a%10]+this.Zhi[a%12]},sTerm:function(a,b){var c=new Date(31556925974.7*(a-1900)+6e4*this.sTermInfo[b]+Date.UTC(1900,0,6,2,5));return c.getUTCDate()},cDay:function(a){var b;switch(a){case 10:b="初十";break;case 20:b="二十";break;case 30:b="三十";break;default:b=this.nStr2[Math.floor(a/10)],b+=this.nStr1[a%10]}return b},month_day:function(a){var b=a||new Date;return b.getDate()},lunar_Info_detail:function(a){var b=this.getCld(a.getFullYear(),a.getMonth()),c=(a.getFullYear(),a.getDate()),d=b[c-1],e={lunar:"",lunarDay:this.cDay(d.lDay),lunarMonth:(d.isLeap?"闰":"")+this.getChinaNum(d.lMonth)+"月",y_Info:"",lunarFestival:d.lunarFestival,solarFestival:d.solarFestival,solarTerms:d.solarTerms,huangliY:"无",huangliJ:"无"};return e.lunar="农历"+(d.isLeap?"闰":"")+this.getChinaNum(d.lMonth)+"月"+this.cDay(d.lDay),e.y_Info=d.cYear+"年 "+d.cMonth+"月 "+d.cDay+"日",e},lunar_year:function(a){var b;return b=localObj["zh-cn"]?a.getFullYear()+"年"+(a.getMonth()+1)+"月 ":a.getFullYear()+" "+localObj.months[a.getMonth()+1]},getLunarTextByDate:function(a){var b,c=this.lunar_Info_detail(a);return c?b=c.lunarFestival?c.lunarFestival:c.solarFestival?c.solarFestival:c.solarTerms?c.solarTerms:"初一"==c.lunarDay?c.lunarMonth:c.lunarDay:""},getChinaNum:function(a){var b;switch(a){case 1:b="一";break;case 2:b="二";break;case 3:b="三";break;case 4:b="四";break;case 5:b="五";break;case 6:b="六";break;case 7:b="七";break;case 8:b="八";break;case 9:b="九";break;case 10:b="十";break;case 11:b="十一";break;case 12:b="腊"}return b},getCld:function(a,b){this.cldCache={};var c=this.getMonthKey(a,b),d=this.cldCache[c];return"undefined"==typeof d&&(d=new e(a,b),this.cldCache[c]=d),d},getMonthKey:function(a,b){return a.toString()+(b+1).toString().leftpad(2)},date_part:function(a){return a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a},week_start:function(a){var b=a.getDay();return config.start_on_monday&&(0==b?b=6:b--),date_part(add_date(a,-1*b,"day"))},add_date:function(a,b,c){var d=new Date(a.valueOf());switch(c){case"day":d.setDate(d.getDate()+b);break;case"week":d.setDate(d.getDate()+7*b);break;case"month":d.setMonth(d.getMonth()+b);break;case"year":d.setYear(d.getFullYear()+b);break;case"hour":d.setHours(d.getHours()+b);break;case"minute":d.setMinutes(d.getMinutes()+b);break;default:return new Date}return d},start_date:function(a){return a.setDate(1),date_part(a)}});var d=function(a){var b,d=new c,e=0,f=0,g=(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate())-Date.UTC(1900,0,31))/864e5;for(b=1900;2100>b&&g>0;b++)f=d.lYearDays(b),g-=f;for(0>g&&(g+=f,b--),this.year=b,e=d.leapMonth(b),this.isLeap=!1,b=1;13>b&&g>0;b++)e>0&&b==e+1&&0==this.isLeap?(--b,this.isLeap=!0,f=d.leapDays(this.year)):f=d.monthDays(this.year,b),1==this.isLeap&&b==e+1&&(this.isLeap=!1),g-=f;0==g&&e>0&&b==e+1&&(this.isLeap?this.isLeap=!1:(this.isLeap=!0,--b)),0>g&&(g+=f,--b),this.month=b,this.day=g+1},e=function(a,b){var e,g,h,i,j,k,l,m,n,o,p,q=new c,r=1,s=0,t=new Array(3),u=0,v=0;e=new Date(a,b,1,0,0,0,0),this.length=q.solarDays(a,b),this.firstWeek=e.getDay(),n=2>b?q.cyclical(a-1900+36-1):q.cyclical(a-1900+36);var w=q.sTerm(a,2),x=q.sTerm(a,2*b);o=q.cyclical(12*(a-1900)+b+12);for(var y=Date.UTC(a,b,1,0,0,0,0)/864e5+25567+10,z=0;z<this.length;z++)r>s&&(e=new Date(a,b,z+1),g=new d(e),h=g.year,i=g.month,r=g.day,j=g.isLeap,s=j?q.leapDays(h):q.monthDays(h,i),0==u&&(v=i),t[u++]=z-r+1),1==b&&z+1==w&&(n=q.cyclical(a-1900+36)),z+1==x&&(o=q.cyclical(12*(a-1900)+b+13)),p=q.cyclical(y+z),this[z]=new f(a,b+1,z+1,q.nStr1[(z+this.firstWeek)%7],h,i,r++,j,n,o,p);k=q.sTerm(a,2*b)-1,l=q.sTerm(a,2*b+1)-1,this[k].solarTerms=q.solarTerm[2*b],this[l].solarTerms=q.solarTerm[2*b+1];for(z in q.sFtv)q.sFtv[z].match(/^(\d{2})(\d{2})([\s\*])(.+)$/)&&Number(RegExp.$1)==b+1&&(this[Number(RegExp.$2)-1].solarFestival+=RegExp.$4);for(z in q.wFtv)q.wFtv[z].match(/^(\d{2})(\d)(\d)([\s\*])(.+)$/)&&Number(RegExp.$1)==b+1&&(k=Number(RegExp.$2),l=Number(RegExp.$3),5>k?this[(this.firstWeek>l?7:0)+7*(k-1)+l-this.firstWeek].solarFestival+=RegExp.$5:(k-=5,m=(this.firstWeek+this.length-1)%7,this[this.length-m-7*k+l-(l>m?7:0)-1].solarFestival+=RegExp.$5));for(z in q.lFtv)q.lFtv[z].match(/^(\d{2})(.{2})([\s\*])(.+)$/)&&(k=Number(RegExp.$1)-v,-11==k&&(k=1),k>=0&&u>k&&(l=t[k]+Number(RegExp.$2)-1,l>=0&&l<this.length&&1!=this[l].isLeap&&(this[l].lunarFestival+=RegExp.$4)))},f=function(a,b,c,d,e,f,g,h,i,j,k){this.isToday=!1,this.sYear=a,this.sMonth=b,this.sDay=c,this.week=d,this.lYear=e,this.lMonth=f,this.lDay=g,this.isLeap=h,this.cYear=i,this.cMonth=j,this.cDay=k,this.color="",this.lunarFestival="",this.solarFestival="",this.solarTerms=""},g=function(){this._strings=new Array};return a.extend(g.prototype,{toString:function(){var a=0==arguments.length?"":arguments[0];return this._strings.join(a)},append:function(a){return this._strings.push(a),this}}),a.extend(String.prototype,{leftpad:function(a,b){b||(b="0");for(var c="",d=0;d<a-this.length;d++)c+=b;return c+this}}),new c});