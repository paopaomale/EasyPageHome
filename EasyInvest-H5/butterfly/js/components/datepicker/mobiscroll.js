define(["jquery","css!butterfly/components/datepicker/mobiscroll"],function(){function a(a,b,c){var d,h,j,k=this,l=c,m={},n={},o=!1;this.settings=l,this.values=null,this.val=null,this.temp=null,this.setDefaults=function(a){$.extend(z,a)},this.enable=function(){l.disabled=!1,$(a).is(":input")&&$(a).prop("disabled",!1)},this.scroll=function(a,b,c,d,e){function g(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b}if(a.attr("style",(c?u+"-transition:all "+c.toFixed(1)+"s ease-out;":"")+(t?u+"-transform:translate3d(0,"+b*f+"px,0);":"top:"+b*f+"px;")),c){var h=0;clearInterval(m[e]),m[e]=setInterval(function(){h+=.1,a.data("pos",Math.round(g(h,d,b-d,c))),h>=c&&(clearInterval(m[e]),a.data("pos",b))},100),clearTimeout(n[e]),n[e]=setTimeout(function(){a.hasClass("dwa")||a.closest(".dwwl").find(".dwwb").fadeIn("fast")},1e3*c)}else a.data("pos",b)},this.disable=function(){l.disabled=!0,$(a).is(":input")&&$(a).prop("disabled",!0)},this.formatDate=function(a,b,c){if(!b)return null;for(var d=$.extend({},this.settings,c),e=function(b){for(var c=0;j+1<a.length&&a.charAt(j+1)==b;)c++,j++;return c},f=function(a,b,c){var d=""+b;if(e(a))for(;d.length<c;)d="0"+d;return d},g=function(a,b,c,d){return e(a)?d[b]:c[b]},h="",i=!1,j=0;j<a.length;j++)if(i)"'"!=a.charAt(j)||e("'")?h+=a.charAt(j):i=!1;else switch(a.charAt(j)){case"d":h+=f("d",b.getDate(),2);break;case"D":h+=g("D",b.getDay(),d.dayNamesShort,d.dayNames);break;case"o":h+=f("o",(b.getTime()-new Date(b.getFullYear(),0,0).getTime())/864e5,3);break;case"m":h+=f("m",b.getMonth()+1,2);break;case"M":h+=g("M",b.getMonth(),d.monthNamesShort,d.monthNames);break;case"y":h+=e("y")?b.getFullYear():(b.getYear()%100<10?"0":"")+b.getYear()%100;break;case"h":var k=b.getHours();h+=f("h",k>12?k-12:0==k?12:k,2);break;case"H":h+=f("H",b.getHours(),2);break;case"i":h+=f("i",b.getMinutes(),2);break;case"s":h+=f("s",b.getSeconds(),2);break;case"a":h+=b.getHours()>11?"pm":"am";break;case"A":h+=b.getHours()>11?"PM":"AM";break;case"'":e("'")?h+="'":i=!0;break;default:h+=a.charAt(j)}return h},this.parseDate=function(a,b,c){var d=new Date;if(!a||!b)return d;b="object"==typeof b?b.toString():b+"";for(var e=$.extend({},this.settings,c),f=d.getFullYear(),g=d.getMonth()+1,h=d.getDate(),i=-1,j=d.getHours(),k=d.getMinutes(),l=d.getSeconds(),m=-1,n=!1,o=function(b){var c=t+1<a.length&&a.charAt(t+1)==b;return c&&t++,c},p=function(a){o(a);var c="@"==a?14:"!"==a?20:"y"==a?4:"o"==a?3:2,d=new RegExp("^\\d{1,"+c+"}"),e=b.substr(s).match(d);if(!e)throw"Missing number at position "+s;return s+=e[0].length,parseInt(e[0],10)},q=function(a,c,d){for(var e=o(a)?d:c,f=0;f<e.length;f++)if(b.substr(s,e[f].length).toLowerCase()==e[f].toLowerCase())return s+=e[f].length,f+1;throw"Unknown name at position "+s},r=function(){if(b.charAt(s)!=a.charAt(t))throw"Unexpected literal at position "+s;s++},s=0,t=0;t<a.length;t++)if(n)"'"!=a.charAt(t)||o("'")?r():n=!1;else switch(a.charAt(t)){case"d":h=p("d");break;case"D":q("D",e.dayNamesShort,e.dayNames);break;case"o":i=p("o");break;case"m":g=p("m");break;case"M":g=q("M",e.monthNamesShort,e.monthNames);break;case"y":f=p("y");break;case"H":j=p("H");break;case"h":j=p("h");break;case"i":k=p("i");break;case"s":l=p("s");break;case"a":m=q("a",["am","pm"],["am","pm"])-1;break;case"A":m=q("A",["am","pm"],["am","pm"])-1;break;case"'":o("'")?r():n=!0;break;default:r()}if(100>f&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(f<=e.shortYearCutoff?0:-100)),i>-1)for(g=1,h=i;;){var u=32-new Date(f,g-1,32).getDate();if(u>=h)break;g++,h-=u}j=-1==m?j:m&&12>j?j+12:m||12!=j?j:0;var v=new Date(f,g-1,h,j,k,l);if(v.getFullYear()!=f||v.getMonth()+1!=g||v.getDate()!=h)throw"Invalid date";return v},this.setValue=function(b){void 0==b&&(b=!0);var c=this.formatResult();this.val=c,this.values=this.temp.slice(0),b&&$(a).is(":input")&&$(a).val(c).change()},this.getDate=function(){var a=this.values;if("date"==l.preset)return new Date(a[d],a[h],a[j]);if("time"==l.preset){var b=l.ampm?"PM"==a[l.seconds?3:2]&&a[0]-0<12?a[0]-0+12:"AM"==a[l.seconds?3:2]&&12==a[0]?0:a[0]:a[0];return new Date(1970,0,1,b,a[1],l.seconds?a[2]:null)}if("datetime"==l.preset){var b=l.ampm?"PM"==a[l.seconds?6:5]&&a[3]-0<12?a[3]-0+12:"AM"==a[l.seconds?6:5]&&12==a[3]?0:a[3]:a[3];return new Date(a[d],a[h],a[j],b,a[4],l.seconds?a[5]:null)}},this.setDate=function(a,b){if(l.preset.match(/date/i)&&(this.temp[d]=a.getFullYear(),this.temp[h]=a.getMonth(),this.temp[j]=a.getDate()),"time"==l.preset){var c=a.getHours();this.temp[0]=l.ampm?c>12?c-12:0==c?12:c:c,this.temp[1]=a.getMinutes(),l.seconds&&(this.temp[2]=a.getSeconds()),l.ampm&&(this.temp[l.seconds?3:2]=c>11?"PM":"AM")}if("datetime"==l.preset){var c=a.getHours();this.temp[3]=l.ampm?c>12?c-12:0==c?12:c:c,this.temp[4]=a.getMinutes(),l.seconds&&(this.temp[5]=a.getSeconds()),l.ampm&&(this.temp[l.seconds?6:5]=c>11?"PM":"AM")}this.setValue(b)},this.parseValue=function(a){if(this.preset){var b=[];if("date"==l.preset){try{var c=this.parseDate(l.dateFormat,a,l)}catch(e){var c=new Date}b[d]=c.getFullYear(),b[h]=c.getMonth(),b[j]=c.getDate()}else if("time"==l.preset){try{var c=this.parseDate(l.timeFormat,a,l)}catch(e){var c=new Date}var f=c.getHours();b[0]=l.ampm?f>12?f-12:0==f?12:f:f,b[1]=c.getMinutes(),l.seconds&&(b[2]=c.getSeconds()),l.ampm&&(b[l.seconds?3:2]=f>11?"PM":"AM")}else if("datetime"==l.preset){try{var c=this.parseDate(l.dateFormat+" "+l.timeFormat,a,l)}catch(e){var c=new Date}var f=c.getHours();b[d]=c.getFullYear(),b[h]=c.getMonth(),b[j]=c.getDate(),b[3]=l.ampm?f>12?f-12:0==f?12:f:f,b[4]=c.getMinutes(),l.seconds&&(b[5]=c.getSeconds()),l.ampm&&(b[l.seconds?6:5]=f>11?"PM":"AM")}return b}return l.parseValue(a,this)},this.formatResult=function(){var a=this.temp;if(this.preset){if("date"==l.preset)return this.formatDate(l.dateFormat,new Date(a[d],a[h],a[j]),l);if("datetime"==l.preset){var b=l.ampm?"PM"==a[l.seconds?6:5]&&a[3]-0<12?a[3]-0+12:"AM"==a[l.seconds?6:5]&&12==a[3]?0:a[3]:a[3];return this.formatDate(l.dateFormat+" "+l.timeFormat,new Date(a[d],a[h],a[j],b,a[4],l.seconds?a[5]:null),l)}if("time"==l.preset){var b=l.ampm?"PM"==a[l.seconds?3:2]&&a[0]-0<12?a[0]-0+12:"AM"==a[l.seconds?3:2]&&12==a[0]?0:a[0]:a[0];return this.formatDate(l.timeFormat,new Date(1970,0,1,b,a[1],l.seconds?a[2]:null),l)}}return l.formatResult(a)},this.validate=function(a){if(this.preset&&l.preset.match(/date/i)&&(a==d||a==h||-1==a)){var c=32-new Date(this.temp[d],this.temp[h],32).getDate()-1,e=$("ul:eq("+j+")",b);$("li",e).show(),$("li:gt("+c+")",e).hide(),this.temp[j]>c&&(this.scroll(e,g-c-1),this.temp[j]=$("li:eq("+c+")",e).data("val"))}else l.validate(a)},this.hide=function(){return l.onClose(this.val,this)===!1?!1:($(".dwtd").prop("disabled",!1).removeClass("dwtd"),$(a).blur(),b.hide(),e.hide(),o=!1,this.preset&&(l.wheels=null),void $(window).unbind("resize.dw"))},this.show=function(){if(l.disabled||o)return!1;if(l.beforeShow(a,this),f=l.height,g=Math.round(l.rows/2),i=this,this.init(),this.preset){if(l.wheels=new Array,l.preset.match(/date/i)){for(var c={},m=0;3>m;m++)if(m==d){c[l.yearText]={};for(var n=l.startYear;n<=l.endYear;n++)c[l.yearText][n]=l.dateOrder.search(/yy/i)<0?n.toString().substr(2,2):n.toString()}else if(m==h){c[l.monthText]={};for(var n=0;12>n;n++)c[l.monthText][n]=l.dateOrder.search(/MM/)<0?l.dateOrder.search(/M/)<0?l.dateOrder.search(/mm/)<0?n+1:9>n?"0"+(n+1):n+1:l.monthNamesShort[n]:l.monthNames[n]}else if(m==j){c[l.dayText]={};for(var n=1;32>n;n++)c[l.dayText][n]=l.dateOrder.search(/dd/i)<0?n:10>n?"0"+n:n}l.wheels.push(c)}if(l.preset.match(/time/i)){l.stepHour=l.stepHour<1?1:parseInt(l.stepHour),l.stepMinute=l.stepMinute<1?1:parseInt(l.stepMinute),l.stepSecond=l.stepSecond<1?1:parseInt(l.stepSecond);var c={};c[l.hourText]={};for(var n=l.ampm?1:0;n<(l.ampm?13:24);n+=l.stepHour)c[l.hourText][n]=10>n?"0"+n:n;c[l.minuteText]={};for(var n=0;60>n;n+=l.stepMinute)c[l.minuteText][n]=10>n?"0"+n:n;if(l.seconds){c[l.secText]={};for(var n=0;60>n;n+=l.stepSecond)c[l.secText][n]=10>n?"0"+n:n}l.ampm&&(c[l.ampmText]={},c[l.ampmText].AM="AM",c[l.ampmText].PM="PM"),l.wheels.push(c)}}$(".dwc",b).remove();for(var n=0;n<l.wheels.length;n++){var p=$('<div class="dwc'+("scroller"!=l.mode?" dwpm":"")+(l.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><div class="clear" style="clear:both;"></div></div>').insertBefore($(".dwbc",b));for(var q in l.wheels[n]){var r=$(".dwwc .clear",p),c=$('<div class="dwwl dwrc">'+("scroller"!=l.mode?'<div class="dwwb dwwbp">+</div><div class="dwwb dwwbm">&ndash;</div>':"")+'<div class="dwl">'+q+'</div><div class="dww dwrc"><ul></ul><div class="dwwo"></div></div><div class="dwwol"></div></div>').insertBefore(r);for(var s in l.wheels[n][q])$('<li class="val_'+s+'">'+l.wheels[n][q][s]+"</li>").data("val",s).appendTo($("ul",c))}}$(".dww ul",b).each(function(a){for(var b=$("li",this).index($("li.val_"+k.temp[a],this));0>b&&--k.temp[a]>=0;)b=$("li",this).index($("li.val_"+k.temp[a],this));k.scroll($(this),g-(0>b?0:b)-1)}),l.showValue?$(".dwv",b).html(this.formatResult()).show():$(".dwv",b).hide(),k.validate(-1),$("#dw_set",b).text(l.setText).unbind().bind("click",function(a){return k.setValue(),l.onSelect(k.val,i),k.hide(),!1}),$("#dw_cancel",b).text(l.cancelText).unbind().bind("click",function(a){return l.onCancel(k.val,i),k.hide(),!1}),$(":input:not(:disabled)").addClass("dwtd"),$(":input").prop("disabled",!0),e.show(),b.attr("class","dw "+l.theme).show(),o=!0,$(".dww, .dwwl",b).height(l.rows*f),$(".dww",b).each(function(){$(this).width($(this).parent().width()<l.width?l.width:$(this).parent().width())}),$(".dwbc a",b).attr("class",l.btnClass),$(".dww li, .dwwb",b).css({height:f,lineHeight:f+"px"}),$(".dwwc",b).each(function(){var a=0;$(".dwwl",this).each(function(){a+=$(this).outerWidth(!0)}),$(this).width(a)}),$(".dwc",b).each(function(){$(this).width($(".dwwc",this).outerWidth(!0))}),this.pos(),$(window).bind("resize.dw",function(){k.pos()})},this.pos=function(){var a,c,d=0,f=0,g=$(window).width(),h=$(window).height(),i=$(window).scrollTop();$(".dwc",b).each(function(){a=$(this).outerWidth(!0),d+=a,f=a>f?a:f}),a=d>g?f:d,b.width(a),a=b.outerWidth(),c=b.outerHeight(),b.css({left:(g-a)/2,top:i+(h-c)/2}),e.height(0),e.height($(document).height())},this.init=function(){var b=l.dateOrder.search(/y/i),c=l.dateOrder.search(/m/i),e=l.dateOrder.search(/d/i);d=c>b?e>b?0:1:e>b?1:2,h=b>c?e>c?0:1:e>c?1:2,j=b>e?c>e?0:1:c>e?1:2,this.preset=null===l.wheels,this.temp=$(a).is("input")&&null!==this.val&&this.val!=$(a).val()||null===this.values?this.parseValue($(a).val()?$(a).val():""):this.values.slice(0),this.setValue(!1)},this.init(),$(a).is(":input")&&l.showOnFocus&&$(a).data("dwro",$(a).prop("readonly")).prop("readonly",!0),$(a).addClass("scroller").unbind("click").bind("click",function(a){l.showOnFocus&&k.show()})}function b(a){for(var b in a)if(void 0!==s[a[b]])return!0;return!1}function c(){var a=["Webkit","Moz","O","ms"];for(var c in a)if(b([a[c]+"Transform"]))return"-"+a[c].toLowerCase();return""}var d,e,f,g,h,i,j,k,l,m,n={},o=new Date,p=o.getTime(),q=!1,r=null,s=document.createElement(s).style,t=b(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"])&&"webkitPerspective"in document.documentElement.style,u=c(),v="ontouchstart"in window,w=v?"touchstart":"mousedown",x=v?"touchmove":"mousemove",y=v?"touchend":"mouseup",z={width:80,height:26,rows:3,disabled:!1,showOnFocus:!0,showValue:!0,showLabel:!0,wheels:null,theme:"",mode:"scroller",preset:"date",dateFormat:"yy-mm-dd",dateOrder:"ymmdd",ampm:!1,seconds:!1,timeFormat:"hh:ii",startYear:o.getFullYear()-100,endYear:o.getFullYear()+3,monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1","2","3","4","5","6","7","8","9","10","11","12"],dayNames:["星期天","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],shortYearCutoff:"+50",monthText:"月",dayText:"日",yearText:"年",hourText:"时",minuteText:"分",secText:"秒",ampmText:"&nbsp;",setText:"确定",cancelText:"取消",btnClass:"dwb",stepHour:1,stepMinute:5,stepSecond:60,beforeShow:function(){},onClose:function(){},onSelect:function(){},onCancel:function(){},formatResult:function(a){for(var b="",c=0;c<a.length;c++)b+=(c>0?" ":"")+a[c];return b},parseValue:function(a,b){for(var c=b.settings.wheels,a=a.split(" "),d=[],e=0,f=0;f<c.length;f++)for(var g in c[f]){if(void 0!==c[f][g][a[e]])d.push(a[e]);else for(var h in c[f][g]){d.push(h);break}e++}return d},validate:function(){return!0}},A={init:function(b){function c(a){return v?a.originalEvent.changedTouches[0].pageY:a.pageY}function o(a,b,c,e){var f=$("ul",d).index(a);b=b>g-1?g-1:b,b=g-h>b?g-h:b,i.scroll(a,b,c?b==e?.1:Math.abs(.1*(b-e)):0,e,f),i.temp[f]=$("li:eq("+(g-1-b)+")",a).data("val"),i.validate(f),$(".dwv",d).html(i.formatResult())}function s(a){if(B){var b=a.data("pos"),c=b-1;c=g-h>c?g-1:c,o(a,c)}else clearInterval(B)}function t(a){if(C){var b=a.data("pos"),c=b+1;c=c>g-1?g-h:c,o(a,c)}else clearInterval(C)}void 0===b&&(b={});var u={};switch(b.theme){case"ios":u.dateOrder="MMdyy",u.rows=5,u.height=30,u.width=55,u.showValue=!1,u.showLabel=!1;break;case"android":u.dateOrder="Mddyy";break;case"android-ics":case"android-ics light":u.dateOrder="Mddyy",u.rows=7,u.width=90,u.showLabel=!1,u.mode="mixed"}"clickpick"==b.mode&&(u.height=50,u.rows=3);var A=$.extend({},z,u,b),B=!1,C=!1;return $(".dw").length?(e=$(".dwo"),d=$(".dw")):(e=$('<div class="dwo"></div>').hide().appendTo("body"),d=$('<div class="dw"><div class="dwv">&nbsp;</div><div class="dwbc" style="clear:both;"><span class="dwbw dwb-c"><a id="dw_cancel" href="#"></a></span><span class="dwbw dwb-s"><a id="dw_set" href="#"></a></span></div></div>'),d.hide().appendTo("body"),$(document).bind(x,function(a){if(q){a.preventDefault(),k=c(a);var b=m+(k-j)/f;b=b>g-1+1?g-1+1:b,b=g-h-1>b?g-h-1:b,i.scroll(r,b)}}),$(document).bind(y,function(a){if(q){a.preventDefault(),r.removeClass("dwa");var b=new Date-l,c=m+(k-j)/f;if(c=c>g-1+1?g-1+1:c,c=g-h-1>c?g-h-1:c,300>b){var d=(k-j)/b,e=d*d/.0012;0>k-j&&(e=-e)}else var e=k-j;o(r,Math.round(m+e/f),!0,Math.round(c)),q=!1,r=null}clearInterval(B),clearInterval(C),B=!1,C=!1,$(".dwb-a").removeClass("dwb-a")}),d.delegate(".dwwl","DOMMouseScroll mousewheel",function(a){a.preventDefault(),a=a.originalEvent;var b=a.wheelDelta?a.wheelDelta/120:a.detail?-a.detail/3:0,c=$("ul",this),d=c.data("pos"),e=Math.round(d+b);h=$("li:visible",c).length,o(c,e)}).delegate(".dwb, .dwwb",w,function(a){$(this).addClass("dwb-a")}).delegate(".dwwbp",w,function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest(".dwwl").find("ul");h=$("li:visible",b).length,clearInterval(B),B=setInterval(function(){s(b)},300),s(b)}).delegate(".dwwbm",w,function(a){a.preventDefault(),a.stopPropagation();var b=$(this).closest(".dwwl").find("ul");h=$("li:visible",b).length,clearInterval(C),C=setInterval(function(){t(b)},300),t(b)}).delegate(".dwwl",w,function(a){q||"clickpick"==i.settings.mode||(a.preventDefault(),q=!0,r=$("ul",this).addClass("dwa"),$(".dwwb",this).fadeOut("fast"),m=r.data("pos"),h=$("li:visible",r).length,j=c(a),l=new Date,k=j,i.scroll(r,m))})),this.each(function(){this.id||(p+=1,this.id="scoller"+p),n[this.id]=new a(this,d,A)})},enable:function(){return this.each(function(){n[this.id]&&n[this.id].enable()})},disable:function(){return this.each(function(){n[this.id]&&n[this.id].disable()})},isDisabled:function(){return n[this[0].id]?n[this[0].id].settings.disabled:void 0},option:function(a,b){return this.each(function(){n[this.id]&&("object"==typeof a?$.extend(n[this.id].settings,a):n[this.id].settings[a]=b,n[this.id].init())})},setValue:function(a,b){return void 0==b&&(b=!1),this.each(function(){n[this.id]&&(n[this.id].temp=a,n[this.id].setValue(a,b))})},getValue:function(){return n[this[0].id]?n[this[0].id].values:void 0},setDate:function(a,b){return void 0==b&&(b=!1),this.each(function(){n[this.id]&&n[this.id].setDate(a,b)})},getDate:function(){return n[this[0].id]?n[this[0].id].getDate():void 0},show:function(){return n[this[0].id]?n[this[0].id].show():void 0},hide:function(){return this.each(function(){n[this.id]&&n[this.id].hide()})},destroy:function(){return this.each(function(){n[this.id]&&($(this).unbind("focus.dw").removeClass("scroller"),$(this).is(":input")&&$(this).prop("readonly",$(this).data("dwro")),delete n[this.id])})}};return function(a,b){return A[b]?A[b].apply(a,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void $.error("Unknown method"):(b.theme||(b.theme="android-ics light"),A.init.apply(a,[b]))}});