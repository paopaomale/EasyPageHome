define([],function(){"use strict";function a(a,b){var c=a.getAttribute("data-view");return c&&(c=c.replace("$","butterfly/")),"."==c||""==c?c=b.replace(".html",""):void 0===c&&(c="butterfly/view"),c}function b(b,c){var d=a(b,c)||"butterfly/view",e=b.querySelectorAll("[data-view]"),f=_.map(e,function(b){return a(b)});return f.unshift(d),f}"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)});var c=function(b,c,d,e){return b.extend({_targetElement:c,_template:d,constructor:function(){if(b.apply(this,arguments),this._targetElement)this.el=this._targetElement;else{var a=document.createElement("div");a.innerHTML=this._template,a=1==a.childElementCount?a.firstElementChild:a,this.el=a}b.apply(this,arguments),this.applyBinding()},applyBinding:function(){var a=this,b=a.el.getAttribute("has-subview");("true"===b||"1"===b)&&_.each(this.el.children,function(b){a.travel(b,a)})},travel:function(b,c){var d=a(b);if(d){var e=require(d),f=new e({el:b,superview:c});c.addSubview(f)}var g=this;_.each(b.children,function(a){g.travel(a,f||c)}),f&&f.render()}})},d=function(a,d,e,f,g){e=/<html/i.test(e)?e.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]:e;var h=document.createElement("div");h.innerHTML=e,h=1==h.childElementCount?h.firstElementChild:h,a(b(h,d),function(){var a=arguments[0],b=c(a,null,e,d);f(b)},g)},e=function(a,b,c,e){if(console.log("loadView: %s",b),"string"==typeof b&&b.endsWith("html"))a(["text!"+b],function(f){d(a,b,f,c,e)},e);else{if("string"!=typeof b)throw new Error("view loader plugin require a view name of string type");a([b],c,e)}},f={load:function(a,b,c,d){e(b,a,function(a){c(a)},function(a){c.error(a)})},getBinding:a,loadView:function(a,d,e){require(b(a),function(){var b=arguments[0],e=c(b,a);d(e)},e)}};return f});