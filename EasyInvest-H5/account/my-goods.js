define(["butterfly/view","butterfly","listview/ListView","../shared/js/datasource","../account/account-client","../shared/js/loading","dialog"],function(a,b,c,d,e,f,g){return a.extend({events:{"click .go-back":"goBack","click #bind-goods":"bindGoods","click #selectBindGoods":"selectBindGoods","click .unbind-goods":"unbindGoods"},render:function(){console.log("render"),this.initLoading(),this.initListView(),this.getBindGoodsList()},onShow:function(){},unbindGoods:function(){var a=this,b=JSON.parse(a.$("#selectBindGoods").attr("selectgoodsdata").trim()),c={pid:b.pid,account:b.account};e.unbindGoods({data:c,beforeSend:function(){a.loading&&a.loading.show()},success:function(a){0==a.result&&g.showToast("解绑成功")},error:function(a){console.log(4)},complete:function(){a.loading&&a.loading.hide()}})},initLoading:function(){this.loading=new f({parentEl:this.$(".container")[0]})},getBindGoodsList:function(){var a=this,b={};e.getBindGoodsList({data:b,beforeSend:function(){a.loading&&a.loading.show()},success:function(b){0==b.result?a.initMobiscroll(b):g.showToast(b.error)},error:function(a){console.log(4)},complete:function(){a.loading&&a.loading.hide()}})},selectBindGoods:function(){var a=this;setTimeout(function(){a.$("#selectBindGoods").mobiscroll("show")},300)},initMobiscroll:function(a){var b=this,c={theme:"ios",mode:"Scroller",display:"bottom",lang:"zh",context:b.$el,inputClass:"bind-goods-input",onShow:function(a){},onSelect:function(a,b){$(this).attr("selectGoodsData",b._options.dataValue)}},d={pid:a.data[0].pid,account:a.data[0].dealAccount};b.$("#selectBindGoods").attr("selectGoodsData",JSON.stringify(d));var e=_.template(b.$el.find("#bind-goods-list-template").html()),f="";_.each(a.data,function(a){f+=e(a)}),b.$el.find("#selectBindGoods").html(f),b.$el.find("#selectBindGoods").mobiscroll().select(c)},bindGoods:function(){console.log("bindGoods"),butterfly.navigate("#account/bind-goods.html")},initListView:function(){var a=this;a.datasource=new d({storage:"session",identifier:"my-message",url:e.GET_MY_GOOODS_LIST_URL,pageParam:"pageIndex"});var b=this.el.querySelector("#goods-transaction-list"),f=_.template(this.$("#my-goods-list-template").html());a.listview=new c({id:"my-goods",el:b,autoLoad:"true",itemTemplate:f,dataSource:this.datasource}),a.listenTo(a.listview,"itemSelect",a.onItemSelect)},onItemSelect:function(a){console.log("onItemSelect")}})});