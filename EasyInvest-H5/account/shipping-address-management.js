define(["butterfly/view","butterfly","account/account-client","dialog","../shared/js/loading","iscroll","json!../shared/js/location/data/data.min.json"],function(a,b,c,d,e,f,g){return a.extend({events:{"click .go-back":"goBack","click #edit":"onEdit","click #delete":"onDelete","click #setDefaultAddress":"onDefaultAddress","click .back":"goBack","click #newAddress":"newAddress"},addressManagementData:[],render:function(){this.loading=new e({parentEl:this.$(".container")[0]})},onShow:function(a){this.getAddressManagementData()},getAddressString:function(a,b,c){var d=_.find(g.data,function(b){return b.areaid==a}),e=_.find(d.al,function(a){return a.areaid==b}),f=_.find(e.al,function(a){return a.areaid==c}),h={provinceName:d.areaname,cityName:e.areaname,areaName:f.areaname};return h},deleteAddress:function(a){var b=this,c=$(a.currentTarget).attr("addressid"),e={id:c};d.createDialog({container:this.el,buttons:{"取消":function(){this.close()},"确定":function(){b.sureDelete(e),this.close()}},content:"是否删除该地址?"})},sureDelete:function(a){var b=this;c.deleteAddress({data:a,beforeSend:function(){b.loading&&b.loading.show()},success:function(a){0==a.result?(d.showToast("删除收货地址，成功"),b.$("#addressManagementContent").html(""),b.getAddressManagementData()):d.showToast(c.statusString(a.result))},error:function(a,b){d.showToast("数据获取失败,请检查网络")},complete:function(){b.loading&&b.loading.hide()}})},initIscroll:function(){var a=this;a.myScroll?a.myScroll.refresh():a.myScroll=new f(a.$(".container")[0],{mouseWheel:!0})},setDefaultAddress:function(a){var b=this,e={id:a};c.setDefaultAddress({data:e,beforeSend:function(){b.loading&&b.loading.show()},success:function(a){0==a.result?(d.showToast("设置默认收货地址成功"),b.getAddressManagementData()):d.showToast(MyClient.statusString(a.result))},error:function(a,b){d.showToast("数据获取失败,请检查网络")},complete:function(){b.loading&&b.loading.hide()}})},newAddress:function(){butterfly.navigate("my/create-address.html",{isPopupView:!0})},setArrRemoveFunction:function(){Array.prototype.remove=function(a){if(isNaN(a)||a>this.length)return!1;for(var b=0,c=0;b<this.length;b++)this[b]!=this[a]&&(this[c++]=this[b]);this.length-=1}},getAddressManagementData:function(){var a=this,b={};_$notData=$("<div class = 'msg-notice notData'>您还没有添加收货地址</div>"),c.getAddressManagementData({data:b,beforeSend:function(){a.loading&&a.loading.show()},success:function(b){0==b.result?b.data.length>0?(a.$("#addressManagementContent").html(""),a.addressManagementData=b.data,a.initAddressManagementView()):a.$("#addressManagementContent").append(_$notData):1007==b.result?a.$("#addressManagementContent").append(_$notData):d.showToast(MyClient.statusString(b.result))},error:function(a,b){d.showToast("数据获取失败,请检查网络")},complete:function(){a.loading&&a.loading.hide()}})},initAddressManagementView:function(){var a=this,b=a.$("#addressManagementContent");a.$("#addressManagementContent").html("");for(var c=0,d=a.addressManagementData.length;d>c;c++){a.addressManagementData[c].addressData=a.getAddressString(a.addressManagementData[c].provinceId,a.addressManagementData[c].cityId,a.addressManagementData[c].areaId);var e=_.template(a.$("#addressManagement_template").html(),a.addressManagementData[c]);b.append(e)}a.setDefaultStyle()},setDefault:function(a){var b=this,c=b.addressManagementData;b.addressManagementData=[];for(var d=0,e=c.length;e>d;d++)a===d&&(b.addressManagementData.push(c[d]),c.remove(d));_.forEach(c,function(a,c){b.addressManagementData.push(a)}),b.initAddressManagementView()},onDefaultAddress:function(a){var b=this;return $current=$(a.currentTarget),$current.find(".address_iconBox").hasClass("check")?void d.showToast("已经是默认地址，请勿重复点击"):void b.setDefaultAddress($current.attr("addressid"))},setDefaultStyle:function(){var a=this,b=$(a.$("#addressManagementContent >li")[0]);b.find(".address_iconBox").addClass("check"),b.find(".address_icon").show(),b.find(".defaultAddress").show(),b.find(".address_iconBox").attr("style","border:0px;")},onEdit:function(a){var b=$(a.currentTarget).attr("addressdata");butterfly.navigate("account/create-address.html",{type:"editAddress",data:b,isPopupView:!0})},onDelete:function(a){var b=this;b.deleteAddress(a)}})});