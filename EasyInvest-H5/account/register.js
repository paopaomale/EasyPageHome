define(["butterfly/view","butterfly","text!account/register.html","account/account-client","dialog"],function(a,b,c,d,e){return a.extend({events:{"click .go-back":"goBack","click .register_box_row":"focusInput","click .getCode":"getCodeBefore","click #submite":"goRegisterBefore","input .input-close":"isCloseHide","click .close-container":"clearInput"},render:function(){},onShow:function(){},focusInput:function(a){$(a.currentTarget).find("input").focus()},getCodeBefore:function(a){a.stopPropagation();var b=this.$("#phone input").val().trim();return""===b?void e.showToast("手机号不能为空"):void this.checkPhone(b)},checkPhone:function(a){var b=this,c={phone:a};d.ajax({url:d.USER_PHONE_URL,type:"post",data:c,noToken:!0,beforeSend:function(){},success:function(c){c&&0===c.result?b.getCode(a):e.showToast(c.error)},complete:function(){}})},getCode:function(a){var b={phone:a};d.ajax({url:d.AUTH_SMS_URL,type:"post",data:b,noToken:!0,beforeSend:function(){},success:function(a){a&&0===a.result?e.showToast("获取验证码成功"):e.showToast(a.error)},complete:function(){}})},goRegisterBefore:function(){var a=this.$("#name input").val().trim(),b=this.$("#phone input").val().trim(),c=this.$("#code input").val().trim(),d=this.$("#referral input").val().trim(),f=this.$("#password input").val(),g=this.$("#check-password input").val(),h=this.$("#protocol")[0].checked;h||e.showToast("请先同意e财通注册协议");var i={name:a||void 0,username:b,code:c,referral:d||void 0,password:f};this.checkData(i,g)&&this.checkCode(i)},checkCode:function(a){var b=this,c={phone:a.username,code:a.code};d.ajax({url:d.AUTH_CHECKSMS_URL,type:"post",data:c,noToken:!0,beforeSend:function(){},success:function(c){c&&0===c.result?b.goRegister(a):e.showToast(c.error)},complete:function(){}})},goRegister:function(a){d.ajax({url:d.USER_REGISTER_URL,type:"post",data:a,noToken:!0,beforeSend:function(){},success:function(a){a&&0===a.result?(e.showToast("注册成功"),butterfly.back()):e.showToast(a.error)},complete:function(){}})},checkData:function(a,b){return""===a.username?(e.showToast("手机号不能为空"),!1):""===a.code?(e.showToast("验证码不能为空"),!1):""===a.password||""===b?(e.showToast("密码不能为空"),!1):a.password!==b?(e.showToast("两次输入的密码不一致"),!1):!0},isCloseHide:function(a){var b=$(a.currentTarget);0!=b.val().trim().length?b.next().show():b.next().hide()},clearInput:function(a){$(a.currentTarget).prev().val(""),$(a.currentTarget).hide()}})});