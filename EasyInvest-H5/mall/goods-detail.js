define(["butterfly/view","butterfly","../mall/mall-client","listview/ListView","../shared/js/datasource","../shared/js/loading","dialog","swipe","iscrollprobe"],function(a,b,c,d,e,f,g){return a.extend({events:{"click .go-back":"goBack","click .menuLi":"goodsList","click #addShoppingCart":"addShoppingCart","click #goCart":"goCart","click #redeemNow":"goPay"},render:function(a){this.initLoading(),this.getGoodsDetailData(a.goodId)},onShow:function(a){this.initAdSwiper(),this.initIscroller()},goPay:function(){var a=this,b=[];b.push(a.goodDetailData),butterfly.navigate("mall/confirm-order.html",{payData:b})},goCart:function(){butterfly.navigate("mall/shopping-cart.html")},addShoppingCart:function(a){var b=this,c=JSON.parse(window.localStorage.getItem("shoppingCartData"))||[],d=!1;if(c.length>0)for(var e=0,f=c.length;f>e;e++){if(b.goodDetailData.id==c[e].id){c[e].num+=1;break}e==f-1&&(d=!0),d&&(b.goodDetailData.num=1,c.push(b.goodDetailData))}else b.goodDetailData.num=1,c.push(b.goodDetailData);window.localStorage.setItem("shoppingCartData",JSON.stringify(c)),g.showToast("添加购物车成功！")},initLoading:function(){this.loading=new f({parentEl:this.$(".container")[0]})},getGoodsDetailData:function(a){var b=this,d={id:a};c.getGoodsDetailData({data:d,beforeSend:function(){b.loading&&b.loading.show()},success:function(a){b.goodDetailData=a.data,b._initView(a)},complete:function(){b.loading&&b.loading.hide()}})},_initView:function(a){var b=this,c=_.template(b.$("#goods-detail-img-template").html(),a.data);b.$(".one-row-integral").html(a.data.price),console.log(c),b.$(".swiper-wrapper").append(c),b.goodId=a.data.id},initAdSwiper:function(){var a=this;this.$el.find("#adSwipe .swiper-container");console.log(a.$("#adSwipe .swiper-container")[0]),a.swipe1=new Swipe(a.$("#adSwipe .swiper-container")[0],{continuous:!0,callback:function(b){a.adCount<=b&&(b-=a.adCount),a.$(".addImg-pagination > span.active").removeClass("active"),$(a.$(".addImg-pagination > span")[b]).addClass("active")}})},initIscroller:function(){var a=this;a.imgScroll=new IScroll(a.$("#goods-detail-wrapper")[0],{bounce:!1,probeType:2});var b=function(){a.setHeader(this)};a.imgScroll&&a.imgScroll.on("scroll",b)},setHeader:function(a){var b=this;if(b.isGoodsDown)return b.isGoodsDown=!1,b.$(".header.opa").removeClass("opa"),b.$(".header").css("background-color","rgba(255,255,255,1)"),b.$(".background-i").css("background-color","rgba(0,0,0,0)"),b.$(".header .showColor").removeClass("showColor"),void b.$(".header .showColorH1").removeClass("showColorH1");if(0!=b.isGoodsDown){var c=-a.y,d=b.$(".header").width()-b.$(".header").innerHeight();if(0>c?b.$(".header").css("background-color","rgba(255,255,255,0)"):c>d?b.$(".header").css("background-color","rgba(255,255,255,1)"):b.$(".header").css("background-color","rgba(255,255,255,"+c/d+")"),0>c)b.$(".header").addClass("opa"),b.$(".header .background-i").css("background-color","rgba(0,0,0,0.3)");else if(c>d/2){b.$(".header.opa").removeClass("opa"),b.$(".header .background-i").css("background-color","rgba(0,0,0,0)");var e=c/(d/2)-1;e=e>1?1:e,b.$(".showColor").css("color","rgba(153,153,153,"+e+")"),b.$(".showColorH1").css("opacity",e)}else{var f=.3-c/(2*d),g=1-c/(d/2);f>0?(b.$(".header").addClass("opa"),f=f):(b.$(".header.opa").removeClass("opa"),f=0),b.$(".showColor").css("color","rgba(255,255,255,"+g+")"),b.$(".header .background-i").css("background-color","rgba(0,0,0,"+f+")")}}}})});