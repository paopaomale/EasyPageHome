define(["butterfly/view","butterfly","listview/ListView","../shared/js/datasource","../mall/mall-client","../shared/js/loading","dialog"],function(a,b,c,d,e,f,g){return a.extend({events:{"click .go-back":"goBack","click .confirm-pay":"confirmPay"},render:function(a){this.initLoading(),this._initOrderList(a.payData)},onShow:function(a){console.log("render")},initLoading:function(){this.loading=new f({parentEl:this.$(".container")[0]})},getOrderData:function(){for(var a=this,b=a.$("#order-list .goods-info"),c=[],d=0,e=b.length;e>d;d++){var f={id:$(b[d]).attr("goods-id"),count:$(b[d]).find(".order-num").html()};c.push(f)}return c},confirmPay:function(){console.log("confirmPay");var a=this,b={goods:a.getOrderData(),phone:$(".order-phone").html(),contact:$(".order-name").html(),address:$(".order-address").html(),token:window.localStorage.getItem("token")};console.warn(b),e.submitOrder({data:JSON.stringify(b),beforeSend:function(){a.loading&&a.loading.show()},success:function(a){0==a.result||g.showToast(a.error)},complete:function(){a.loading&&a.loading.hide()}})},_initOrderList:function(a){var b=this,c=_.template(b.$("#cart-list-template").html(),a);b.$(".order-box").append(c),b.sumPayment()},sumPayment:function(){for(var a=this,b=a.$(".total-price"),c=0,d=0,e=b.length;e>d;d++)c+=parseInt($(b[d]).html());a.$(".sum-num .total-price").html(c)}})});