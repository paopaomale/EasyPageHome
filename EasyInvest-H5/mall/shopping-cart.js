define(["butterfly/view","butterfly","listview/ListView","../shared/js/datasource","../account/account-client"],function(a,b,c,d,e){return a.extend({events:{"click .go-back":"goBack","click .cart-list-tr-row-icon":"selectGoods","click .icon-minus":"minusGoods","click .icon-add":"addGoods","click .checkbox-all,.check-all":"selectAllGoods","click #btn_edit":"editShoppingCart","click .js-go-pay":"goPay"},render:function(){console.log("render"),this.initListView()},onShow:function(){console.log("render")},goPay:function(){console.log("goPay")},editShoppingCart:function(a){var b=this;$currObj=$(a.currentTarget),$currObj.hasClass("edit")?($currObj.html("完成"),$currObj.removeClass("edit"),$currObj.addClass("complete"),$(".cart-list-tr-row-icon > i").removeClass(),$(".cart-list-tr-row-icon > i").addClass("icon-radio-unchecked"),$(".checkbox-wrap>i").removeClass(),$(".checkbox-wrap>i").addClass("icon-radio-unchecked"),b.$(".js-go-pay").hide(),b.$(".total-price").hide(),b.$(".js-delete").show()):($currObj.html("编辑"),$currObj.removeClass("complete"),$currObj.addClass("edit"),b.$(".js-go-pay").show(),b.$(".js-delete").hide(),b.$(".total-price").show())},setGoodsPriceSum:function(){for(var a=this,b=a.$(".good-num"),c=0,d=0,e=b.length;e>d;d++){var f=$(b[d]).parents(".cart-list-tr"),g=parseInt(f.find(".good-num").html()),h=parseInt(f.find(".cart-goods-price").attr("goods-price")),i=f.find(".cart-list-tr-row-icon > i").hasClass("icon-checked-fill");i&&(c+=g*h)}a.$(".big-font").html(c+"积分")},isSelectAllGoods:function(){for(var a=this,b=a.$(".cart-list-tr-row-icon>i"),c=!1,d=0,e=b.length;e>d;d++){if(!$(b[d]).hasClass("icon-checked-fill")){c=!1;break}c=!0}return c},selectAllGoods:function(a){var b=this,c=b.$(".checkbox-wrap");c.find("i").hasClass("icon-checked-fill")?(c.find("i").addClass("icon-radio-unchecked"),c.find("i").removeClass("icon-checked-fill"),b.$(".cart-list-tr-row-icon>i").removeClass(),b.$(".cart-list-tr-row-icon>i").addClass("icon-radio-unchecked")):(c.find("i").addClass("icon-checked-fill"),c.find("i").removeClass("icon-radio-unchecked"),b.$(".cart-list-tr-row-icon>i").removeClass(),b.$(".cart-list-tr-row-icon>i").addClass("icon-checked-fill")),b.setGoodsPriceSum()},selectGoods:function(a){var b=this,c=b.$(".checkbox-wrap");this.isSelectAllGoods()&&(c.find("i").addClass("icon-radio-unchecked"),c.find("i").removeClass("icon-checked-fill")),$(a.currentTarget).find("i").hasClass("icon-checked-fill")?($(a.currentTarget).find("i").addClass("icon-radio-unchecked"),$(a.currentTarget).find("i").removeClass("icon-checked-fill")):($(a.currentTarget).find("i").addClass("icon-checked-fill"),$(a.currentTarget).find("i").removeClass("icon-radio-unchecked")),this.isSelectAllGoods()&&(c.find("i").addClass("icon-checked-fill"),c.find("i").removeClass("icon-radio-unchecked")),b.setGoodsPriceSum()},minusGoods:function(a){var b=this,c=$(a.currentTarget).parent().find(".good-num");goodsNum=parseInt(c.html()),goodsNum>0&&c.html(--goodsNum),b.setGoodsPriceSum()},addGoods:function(a){var b=this,c=$(a.currentTarget).parent().find(".good-num");goodsNum=parseInt(c.html()),c.html(++goodsNum),b.setGoodsPriceSum()},initListView:function(){var a=this;a.datasource=new d({storage:"session",identifier:"shopping-cart",url:e.GET_MESSAGE_URL,pageParam:"pageIndex"});var b=this.el.querySelector("#cart-list"),f=_.template(this.$("#cart-list-template").html());a.listview=new c({id:"shopping-cart",el:b,autoLoad:"true",itemTemplate:f,dataSource:this.datasource}),a.listenTo(this.listview,"itemSelect",this.onItemSelect)}})});