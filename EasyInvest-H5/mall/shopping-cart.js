define(["butterfly/view","butterfly","listview/ListView","../shared/js/datasource","../account/account-client","dialog"],function(a,b,c,d,e,f){return a.extend({events:{"click .go-back":"goBack","click .cart-list-tr-row-icon":"selectGoods","click .icon-minus":"minusGoods","click .icon-add":"addGoods","click .checkbox-all,.check-all":"selectAllGoods","click #btn_edit":"editShoppingCart","click .js-go-pay":"goPay","click .js-delete":"deleteGoods"},render:function(){Array.prototype.remove=function(a){if(isNaN(a)||a>this.length)return!1;for(var b=0,c=0;b<this.length;b++)this[b]!=this[a]&&(this[c++]=this[b]);this.length-=1},this.initListView()},onShow:function(){console.log("render")},getPayData:function(){for(var a=this,b=JSON.parse(window.localStorage.getItem("shoppingCartData")),c=a.$(".cart-list-tr-row-icon .icon-checked-fill"),d=[],e=0,f=c.length;f>e;e++){var g=$(c[e]).parent().attr("data-indx");data={num:b[g].num,payment:b[g].payment,name:b[g].name,id:b[g].id},d.push(data)}return d},goPay:function(){var a=this,b=a.getPayData(),c={payData:b};$(".cart-list-tr-row-icon .icon-checked-fill").length>0?butterfly.navigate("mall/confirm-order.html",c):f.showToast("请选择一个商品!")},editShoppingCart:function(a){var b=this;$currObj=$(a.currentTarget),$currObj.hasClass("edit")?($currObj.html("完成"),$currObj.removeClass("edit"),$currObj.addClass("complete"),b.$(".cart-list-tr-row-icon > i").removeClass(),b.$(".cart-list-tr-row-icon > i").addClass("icon-radio-unchecked"),b.$(".checkbox-wrap>i").removeClass(),b.$(".checkbox-wrap>i").addClass("icon-radio-unchecked"),b.$(".js-go-pay").hide(),b.$(".total-price").hide(),b.$(".js-delete").show()):($currObj.html("编辑"),$currObj.removeClass("complete"),$currObj.addClass("edit"),b.$(".js-go-pay").show(),b.$(".js-delete").hide(),b.$(".total-price").show()),b.setGoodsPriceSum()},setGoodsPriceSum:function(){for(var a=this,b=a.$(".good-num"),c=0,d=0,e=b.length;e>d;d++){var f=$(b[d]).parents(".cart-list-tr"),g=parseInt(f.find(".good-num").html()),h=parseInt(f.find(".cart-goods-price").attr("goods-price")),i=f.find(".cart-list-tr-row-icon > i").hasClass("icon-checked-fill");i&&(c+=g*h)}a.$(".big-font").html(c+"积分")},isSelectAllGoods:function(){for(var a=this,b=a.$(".cart-list-tr-row-icon>i"),c=!1,d=0,e=b.length;e>d;d++){if(!$(b[d]).hasClass("icon-checked-fill")){c=!1;break}c=!0}return c},selectAllGoods:function(a){var b=this,c=b.$(".checkbox-wrap");c.find("i").hasClass("icon-checked-fill")?(c.find("i").addClass("icon-radio-unchecked"),c.find("i").removeClass("icon-checked-fill"),b.$(".cart-list-tr-row-icon>i").removeClass(),b.$(".cart-list-tr-row-icon>i").addClass("icon-radio-unchecked")):(c.find("i").addClass("icon-checked-fill"),c.find("i").removeClass("icon-radio-unchecked"),b.$(".cart-list-tr-row-icon>i").removeClass(),b.$(".cart-list-tr-row-icon>i").addClass("icon-checked-fill")),b.setGoodsPriceSum()},selectGoods:function(a){var b=this,c=b.$(".checkbox-wrap");this.isSelectAllGoods()&&(c.find("i").addClass("icon-radio-unchecked"),c.find("i").removeClass("icon-checked-fill")),$(a.currentTarget).find("i").hasClass("icon-checked-fill")?($(a.currentTarget).find("i").addClass("icon-radio-unchecked"),$(a.currentTarget).find("i").removeClass("icon-checked-fill")):($(a.currentTarget).find("i").addClass("icon-checked-fill"),$(a.currentTarget).find("i").removeClass("icon-radio-unchecked")),this.isSelectAllGoods()&&(c.find("i").addClass("icon-checked-fill"),c.find("i").removeClass("icon-radio-unchecked")),b.setGoodsPriceSum()},deleteGoods:function(a){for(var b=this,c=JSON.parse(window.localStorage.getItem("shoppingCartData")),d=b.$(".cart-list-tr-row-icon .icon-checked-fill"),e=0,f=d.length;f>e;e++){var g=parseInt($(b.$(".cart-list-tr-row-icon .icon-checked-fill")[e]).parent().attr("data-indx"));c.remove(g)}window.localStorage.setItem("shoppingCartData",JSON.stringify(c)),b.initListView()},minusGoods:function(a){var b=this,c=JSON.parse(window.localStorage.getItem("shoppingCartData")),d=$(a.currentTarget).parent().find(".good-num"),e=$(a.currentTarget).parent().attr("data-indx"),f=parseInt(d.html());c[e].num-=1,window.localStorage.setItem("shoppingCartData",JSON.stringify(c)),f>0&&d.html(--f),b.setGoodsPriceSum()},addGoods:function(a){var b=this,c=JSON.parse(window.localStorage.getItem("shoppingCartData")),d=$(a.currentTarget).parent().find(".good-num"),e=parseInt(d.html()),f=$(a.currentTarget).parent().attr("data-indx");c[f].num+=1,window.localStorage.setItem("shoppingCartData",JSON.stringify(c)),d.html(++e),b.setGoodsPriceSum()},initListView:function(){var a=this,b=JSON.parse(window.localStorage.getItem("shoppingCartData")),c=(this.el.querySelector("#cart-list"),_.template(this.$("#cart-list-template").html(),b));0==b.length?a.$(".cart-footer").hide():a.$(".cart-footer").show(),a.$("#cart-list").html(""),a.$("#cart-list").append(c)}})});