define(["backbone","text!shared/profile/profile.json","dialog","json!shared/back-code.json","shared/js/loading"],function(a,b,c,d,e){var f=JSON.parse(b).serverUrl,g=JSON.parse(b).baseServerUrl;return window._serverBasePath=g,{basePath:f,pageSize:10,path_login:f+"/user/login",request:function(a){var b,c=decodeURI(location.href),d=c.substring(c.indexOf("?")+1,c.length).split("&");for(i=0;i<d.length;i++){var e=d[i].split("=")[0],f=d[i].split("=")[1];e===a&&(b=f)}return"undefined"==typeof b?"":b},ajax:function(a){var b=this,d=_.pick(a,["success","error"]),e={dataType:"json",type:!a.type&&a.type||"GET",timeout:15e3,error:function(){c.showToast("数据获取失败,请检查网络")}};a=_.extend(e,a),"undefined"==typeof a.data&&(a.data={});var f=window.localStorage.getItem("token")||"";a.noToken?delete a.noToken:a.data.token=f;var g=_.extend(a,{success:function(e){-1==e.result?(console.log("token 过期"),b.refreshToken({success:function(b){0==b.result?(window.localStorage.setItem("token",b.data.token),a.data.token=b.data.token,$.ajax(a)):(window.localStorage.removeItem("myInfo"),c.showToast("登录过期，请重新登录"),butterfly.navigate("account/login.html"))},error:function(a){c.showToast(a)}})):("auth-fail"===e.other&&(localStorage.clear(),sessionStorage.clear()),d.success(e))},error:a.error});return $.ajax(g)},isNull:function(a){var b=!0;return"string"==typeof a&&(a=a.trim()),("undefined"!=typeof a&&a&&0!==a.length||"function"==typeof a)&&(b=!1),b},statusString:function(a){var b=d;return!b[a]&&"网络开小差了,请稍后再试"||b[a]},refreshToken:function(a){this.ajax({url:this.path_login,type:"post",noToken:!0,data:{username:window.localStorage.getItem("account"),password:window.localStorage.getItem("password")},success:a.success,beforeSend:a.beforeSend,error:a.error,complete:a.complete})},haveToken:function(){var a=localStorage.getItem("token");return a?!0:!1},_getLocalUser:function(){var a=JSON.parse(localStorage.getItem("myInfoData"))&&JSON.parse(localStorage.getItem("myInfoData")).data;return a?a.user:void 0},_getLocalUserName:function(){var a=this._getLocalUser();return a?a.name:void 0},_getLocalUserAccount:function(){var a=this._getLocalUser();return a?a.account:void 0}}});